---
import { labels } from "../i18n/ui";

type Lang = keyof typeof labels;

const currentLang = (Astro.currentLocale || "en") as Lang;
const contact = Object.fromEntries(Object.entries(labels[currentLang].contact));
---

<div class="text-center">
  <h2 class="text-4xl font-bold text-primary mb-4">{contact.title}</h2>
  <p class="text-xl font-bold">{contact.subtitle}</p>
</div>

<div class="py-10 relative">
  <div
    id="form-message"
    class="hidden absolute top-0 right-0 bg-green-600 text-white font-bold px-4 py-2 rounded shadow-lg z-50"
  >
    {contact.success}
  </div>
  <form
    id="contact-form"
    action="https://formspree.io/f/movlwvbk"
    method="POST"
    class="flex flex-col gap-4"
  >
    <input
      type="text"
      name="from_name"
      placeholder={contact.name}
      required
      class="px-4 py-2 bg-menu/50 text-foreground border border-primary rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
    />
    <input
      type="email"
      name="reply_to"
      placeholder={contact.email}
      required
      class="px-4 py-2 bg-menu/50 text-foreground border border-primary rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
    />
    <textarea
      name="message"
      placeholder={contact.message}
      rows="6"
      required
      class="px-4 py-2 bg-menu/50 text-foreground border border-primary rounded-lg focus:outline-none focus:ring-2 focus:ring-primary resize-none"
    ></textarea>
    <button
      type="submit"
      class="px-4 py-2 bg-menu/50 text-foreground rounded-lg opacity-60 transition-opacity border border-primary hover:opacity-100 hover:bg-menu/50 hover:font-bold"
    >
      {contact.submit}
    </button>
  </form>
</div>

<div id="form-message" class="hidden text-green-600 font-bold mt-4">
  Â¡Mensaje enviado correctamente!
</div>

<script type="module" is:inline>
  const form = document.getElementById("contact-form");
  const formMessage = document.getElementById("form-message");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(form);

    try {
      const response = await fetch(form.action, {
        method: "POST",
        body: formData,
        headers: { Accept: "application/json" },
      });
      if (response.ok) {
        form.reset();
        formMessage.classList.remove("hidden");
        setTimeout(() => {
          formMessage.classList.add("hidden");
        }, 4000);
      } else {
        const data = await response.json();
        console.error("Error response:", data);
        alert("There was a problem sending your message.");
      }
    } catch (error) {
      console.error("Error:", error);
      alert("There was a problem sending your message.");
    }
  });
</script>
